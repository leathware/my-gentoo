<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>04 — DWM / Suckless Minimal Desktop Setup (OpenRC)</title>
<style>
  :root { --bg: #fff; --fg: #1a1a1a; --muted: #555; --border: #d0d0d0;
          --code-bg: #f4f4f4; --accent: #4e4187; }
  *, *::before, *::after { box-sizing: border-box; }
  html { font-size: 15px; }
  body { font-family: "Inter", "Segoe UI", system-ui, sans-serif;
         color: var(--fg); background: var(--bg);
         max-width: 52rem; margin: 2rem auto; padding: 0 1.5rem;
         line-height: 1.6; }
  h1 { font-size: 1.8rem; border-bottom: 2px solid var(--accent); padding-bottom: .4rem; }
  h2 { font-size: 1.35rem; margin-top: 2rem; color: var(--accent); }
  h3 { font-size: 1.1rem; margin-top: 1.4rem; }
  blockquote { border-left: 4px solid var(--accent); margin: 1rem 0;
               padding: .5rem 1rem; background: #f9f8ff; color: var(--muted); }
  code { font-family: "JetBrains Mono", "Fira Code", "Consolas", monospace;
         font-size: .88em; background: var(--code-bg); padding: .15em .35em;
         border-radius: 3px; }
  pre { background: var(--code-bg); border: 1px solid var(--border);
        border-radius: 5px; padding: 1rem; overflow-x: auto;
        line-height: 1.45; }
  pre code { background: none; padding: 0; font-size: .85rem; }
  table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
  th, td { border: 1px solid var(--border); padding: .45rem .75rem; text-align: left; }
  th { background: var(--code-bg); }
  hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }
  a { color: var(--accent); }
  .nav { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);
         font-size: .9rem; }
  @media print {
    body { max-width: 100%; margin: 0; padding: 0; font-size: 11pt; }
    pre { white-space: pre-wrap; word-break: break-all; border: 1px solid #ccc; }
    a { color: inherit; text-decoration: none; }
    h2 { page-break-after: avoid; }
    pre, table { page-break-inside: avoid; }
    .nav { display: none; }
  }
</style>
</head>
<body>

<h1>DWM / Suckless Minimal Desktop Setup (OpenRC)</h1>

<blockquote>
Prerequisite: complete <a href="01-post-install-base.html">01-post-install-base</a> first.
Your make.conf should already have the <strong>dwm</strong> profile's USE flags (including <code>savedconfig</code>).
</blockquote>

<hr>

<blockquote>
<strong>Full make.conf reference →</strong>
<a href="00-make-conf-reference.html">make.conf Master Reference</a> — every setting
explained, KDE vs DWM comparison, why <code>minimal</code> is not used globally, and
how to handle USE-flag conflicts with <code>package.use</code>.
</blockquote>

<hr>

<h2>1 — Verify profile &amp; USE flags</h2>

<pre><code># eselect profile show — displays which Portage profile is active.
# For DWM you should be on the plain "desktop" profile (NOT plasma).
# The profile controls base USE flags system-wide.
eselect profile show
# Should be: default/linux/amd64/23.0/desktop  (plain desktop, NOT plasma)

# grep ^USE — shows the USE flag lines from your make.conf.
# These flags control which optional features Portage enables/disables
# when compiling packages. The DWM profile strips out KDE/Qt/GNOME.
cat /etc/portage/make.conf | grep ^USE
# Confirm: X, savedconfig, -kde, -plasma, -qt5, -qt6</code></pre>

<h3>Handling USE-flag conflicts</h3>

<p>With a lean make.conf, you'll occasionally hit packages that need a USE flag
you haven't enabled globally. The quick fix is a per-package override in
<code>/etc/portage/package.use/</code>. For full details and examples, see the
<a href="00-make-conf-reference.html#package-use">make.conf Master Reference</a>.</p>

<pre><code># Quick example — enable a missing flag for one package:
echo "app-text/xmlto text" >> /etc/portage/package.use/dwm

# Or let Portage suggest the fix automatically:
emerge -a --autounmask-write x11-wm/dwm
dispatch-conf          # review and accept the changes
emerge -a x11-wm/dwm</code></pre>

<h2>2 — Install Xorg</h2>

<p>DWM is X11-only (the suckless tools don't support Wayland). Keep it lean:</p>

<pre><code># ── X server and xinit ──────────────────────────────────────────────
# xorg-server is the display server — it manages your screen, input
# devices, and GPU. xinit provides 'startx', the command you'll use
# to launch X from a text console (TTY).
emerge -a x11-base/xorg-server x11-apps/xinit

# ── X11 utilities used in ~/.xinitrc ────────────────────────────────
# xrandr      → query/set screen resolution and refresh rate
# setxkbmap   → set keyboard layout (e.g. us, gb, de)
# xsetroot    → set the root window name (dwm reads this for its status bar)
# xwallpaper  → lightweight wallpaper setter (no feh dependency bloat)
emerge -a x11-apps/xrandr x11-apps/setxkbmap x11-apps/xsetroot x11-misc/xwallpaper

# ── GPU and input drivers ───────────────────────────────────────────
# xf86-video-amdgpu is the DDX (Device Dependent X) driver for AMD GPUs.
# It handles 2D acceleration and modesetting in Xorg.
# xf86-input-libinput is the unified input driver (mouse, keyboard, touchpad).
emerge -a x11-drivers/xf86-video-amdgpu x11-drivers/xf86-input-libinput</code></pre>

<p>No display manager needed — you'll start X from a TTY with <code>startx</code>.
This keeps the system minimal and avoids running a graphical login daemon.</p>

<h2>3 — Install the suckless trinity: dwm + st + dmenu</h2>

<p>Gentoo's suckless ebuilds support <code>savedconfig</code> — a Portage feature where
the package's build-time config file (<code>config.h</code> for suckless tools) is saved to
<code>/etc/portage/savedconfig/</code>. When you re-emerge the package, Portage uses your
saved version instead of the default, so your customisations survive upgrades.</p>

<pre><code># ── Install the three core suckless tools ───────────────────────────
# dwm   → tiling window manager (manages windows in tiled/floating/monocle layouts)
# st    → simple terminal emulator (lightweight, fast, configured via config.h)
# dmenu → dynamic menu (app launcher — type to filter, Enter to launch)
emerge -a x11-wm/dwm x11-terms/st x11-misc/dmenu</code></pre>

<h3>First-time config workflow</h3>

<pre><code># ── Find your savedconfig files ─────────────────────────────────────
# After the first emerge, Portage copies the default config.h to savedconfig.
# These are plain C header files you can edit with any text editor.
ls /etc/portage/savedconfig/x11-wm/dwm-*
ls /etc/portage/savedconfig/x11-terms/st-*
ls /etc/portage/savedconfig/x11-misc/dmenu-*

# ── Customise ───────────────────────────────────────────────────────
# Edit the savedconfig to change keybinds, colours, fonts, layouts, etc.
# This is the suckless philosophy: configuration IS the source code.
nano /etc/portage/savedconfig/x11-wm/dwm-&lt;version&gt;

# ── Rebuild with your changes ──────────────────────────────────────
# Portage reads the savedconfig, compiles dwm with your edits, and installs it.
# The old binary is replaced — logout/login or restart dwm to see changes.
emerge -a x11-wm/dwm</code></pre>

<p>Common <code>config.h</code> tweaks for dwm:</p>

<pre><code>/* Example: change mod key to Super (Win key) */
#define MODKEY Mod4Mask

/* Font — requires a nerd font or terminus */
static const char *fonts[] = { "Terminus:size=12" };

/* Gaps (if you apply the vanitygaps patch) */
static const unsigned int gappx = 6;</code></pre>

<h3>Applying patches (the suckless way)</h3>

<p>If you need patches beyond what <code>savedconfig</code> handles (e.g. vanitygaps, barpadding),
you can use Portage's <strong>user patches</strong> feature. Portage applies any <code>.patch</code> or
<code>.diff</code> file it finds in <code>/etc/portage/patches/&lt;category&gt;/&lt;package&gt;/</code> before
compiling. This is cleaner than patching source manually — the patches are
reapplied automatically on every emerge.</p>

<pre><code># Keep a local copy of your patches for version control
mkdir -p /root/my-gentoo/patches/dwm

# Option A: edit the savedconfig directly (config-only changes like
#           keybinds, fonts, colours — no source code changes needed)

# Option B: use /etc/portage/patches for source-level patches.
# Download patches from https://dwm.suckless.org/patches/ and place them here:
mkdir -p /etc/portage/patches/x11-wm/dwm
cp my-patch.diff /etc/portage/patches/x11-wm/dwm/

# Rebuild — Portage detects the patches, applies them to the source tree,
# then compiles. If a patch fails to apply (e.g. it's for a different version),
# the build stops and tells you which hunk failed.
emerge -a x11-wm/dwm</code></pre>

<h2>4 — Set up ~/.xinitrc</h2>

<blockquote>
<strong>Switch to your normal user now.</strong> Sections 1–3 above ran as root
(emerge needs root). From here on, everything is user-level config —
log in as the user you created in
<a href="01-post-install-base.html">post-install-base step 5</a>, or open a
new TTY and <code>su - youruser</code>.
</blockquote>

<p><code>~/.xinitrc</code> is the script that <code>startx</code> runs when you launch X.
Everything before <code>exec dwm</code> starts as background processes; <code>exec</code> replaces
the shell with dwm, so when dwm exits, X exits and you're back at the TTY.</p>

<p>Use the setup script to generate it automatically:</p>

<pre><code># The base guide cloned the repo to /root/, which isn't readable by
# normal users. Clone a copy to your home directory:
git clone https://github.com/leathware/my-gentoo.git ~/my-gentoo

# This script:
#   • Creates ~/Pictures/wallpaper/ and copies wallpapers from the repo
#   • Generates ~/.xinitrc with display, input, wallpaper, and audio settings
#   • Adds a commented-out autostart block to ~/.bash_profile
#   • Backs up any existing .xinitrc first
~/my-gentoo/scripts/setup-xinitrc.sh</code></pre>

<p>The generated <code>.xinitrc</code> does the following (in order):</p>

<pre><code>#!/bin/sh

# ── Display ───────────────────────────────────────
# Safe default — auto-detect monitors and native resolution.
xrandr --auto

# Uncomment for 1440p @ 154.85 Hz (run 'xrandr' to list your modes first):
# xrandr --output "$(xrandr | grep ' connected' | head -1 | awk '{print $1}')" --mode 2560x1440 --rate 154.85

# ── Input ─────────────────────────────────────────
setxkbmap us
xset r rate 200 35        # 200ms delay, 35 chars/sec repeat

# ── Wallpaper ─────────────────────────────────────
xwallpaper --zoom ~/Pictures/wallpaper/wall2.png

# ── Audio ─────────────────────────────────────────
pipewire &amp;
wireplumber &amp;

# ── Compositor + notifications ────────────────────
picom -b &amp;
dunst &amp;

# ── Status bar ────────────────────────────────────
slstatus &amp;                # or xsetroot loop fallback

exec dwm</code></pre>

<p>The script also adds this to <code>~/.bash_profile</code> (commented out — uncomment
when you're ready to auto-start X on login):</p>

<pre><code># if [[ -z "$DISPLAY" &amp;&amp; "$(tty)" == "/dev/tty1" ]]; then
#     exec startx
# fi</code></pre>

<p>Start X manually from the TTY:</p>

<pre><code>startx</code></pre>

<h2>5 — GPU acceleration</h2>

<pre><code># ── Mesa / Vulkan ───────────────────────────────────────────────────
# mesa         → provides OpenGL (radeonsi) and Vulkan (RADV) drivers
# vulkan-loader → the dispatch library that routes Vulkan API calls
#                 to the correct driver (RADV for AMD)
# vulkan-tools → provides vulkaninfo for diagnostics
emerge -a media-libs/mesa media-libs/vulkan-loader dev-util/vulkan-tools

# Verify that Vulkan sees your GPU through the RADV driver.
# If this shows "llvmpipe" instead, the GPU driver isn't loading — check
# that amdgpu loaded (dmesg | grep amdgpu) and firmware is in place.
vulkaninfo --summary 2&gt;/dev/null | grep deviceName
# → AMD Radeon RX 7800 XT (RADV NAVI32)</code></pre>

<h2>6 — Essential companion tools</h2>

<table>
  <tr><th>Tool</th><th>Package</th><th>Why</th></tr>
  <tr><td><strong>slstatus</strong></td><td><code>x11-misc/slstatus</code></td><td>Suckless status bar for dwm (uses savedconfig too)</td></tr>
  <tr><td><strong>slock</strong></td><td><code>x11-misc/slock</code></td><td>Suckless screen locker</td></tr>
  <tr><td><strong>surf</strong></td><td><code>www-client/surf</code></td><td>Suckless webkit browser (minimal)</td></tr>
  <tr><td><strong>xwallpaper</strong></td><td><code>x11-misc/xwallpaper</code></td><td>Lightweight wallpaper setter (no ImageMagick deps)</td></tr>
  <tr><td><strong>feh</strong></td><td><code>media-gfx/feh</code></td><td>Image viewer (alternate wallpaper setter)</td></tr>
  <tr><td><strong>scrot</strong></td><td><code>media-gfx/scrot</code></td><td>Screenshot tool</td></tr>
  <tr><td><strong>ranger</strong></td><td><code>app-misc/ranger</code></td><td>Terminal file manager</td></tr>
  <tr><td><strong>mpv</strong></td><td><code>media-video/mpv</code></td><td>Lightweight media player (DVDs: <code>mpv dvd://</code>)</td></tr>
  <tr><td><strong>dunst</strong></td><td><code>x11-misc/dunst</code></td><td>Notification daemon</td></tr>
  <tr><td><strong>picom</strong></td><td><code>x11-misc/picom</code></td><td>Compositor (transparency, no-tear)</td></tr>
</table>

<pre><code>emerge -a x11-misc/slstatus x11-misc/slock media-gfx/feh \
  media-gfx/scrot app-misc/ranger media-video/mpv x11-misc/dunst x11-misc/picom</code></pre>

<p>Add picom and dunst to <code>~/.xinitrc</code> before <code>exec dwm</code> (already included
if you used the <code>setup-xinitrc.sh</code> script):</p>

<pre><code># picom is a compositor — it adds transparency, shadows, and vsync
# (eliminates screen tearing). -b runs it in the background (daemon mode).
picom -b &amp;

# dunst is a notification daemon — desktop apps send notifications via D-Bus
# and dunst displays them as small popups. Configure in ~/.config/dunst/dunstrc.
dunst &amp;</code></pre>

<h2>7 — Networking (lightweight)</h2>

<p>With the DWM profile we intentionally disabled NetworkManager (it pulls in
lots of GNOME/polkit dependencies). Use <code>dhcpcd</code> for wired (already set up in
the base guide), or if you need WiFi:</p>

<pre><code># ── wpa_supplicant — WiFi authentication daemon ─────────────────────
# Handles WPA/WPA2/WPA3 handshakes with your access point.
# Works alongside dhcpcd, which handles getting an IP address.
emerge -a net-wireless/wpa_supplicant
rc-update add wpa_supplicant default

# wpa_passphrase generates a properly formatted config block with a
# hashed PSK (pre-shared key). Appending >> adds to the file without
# overwriting existing network blocks.
wpa_passphrase "MySSID" "MyPassword" &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf

# Start the service immediately (it will also auto-start at next boot
# because of the rc-update command above).
rc-service wpa_supplicant start

# Troubleshooting:
#   wpa_cli status           → check connection state
#   wpa_cli scan &amp;&amp; wpa_cli scan_results  → scan for networks
#   cat /var/log/messages | grep wpa       → check logs</code></pre>

<h2>8 — Fonts</h2>

<pre><code># ── Terminus — a clean bitmap font, perfect for terminals ───────────
# Bitmap fonts render pixel-perfectly at specific sizes (no anti-aliasing
# needed). Common in suckless setups for speed and clarity.
emerge -a media-fonts/terminus-font

# ── Noto / Nerd Fonts (optional, for broader glyph coverage) ───────
# noto         → Google's "No Tofu" font — covers virtually all Unicode scripts
# noto-emoji   → colour emoji support
# nerd-fonts   → patched fonts with icons (Powerline, Font Awesome, etc.)
#               used by status bars and terminal prompts
emerge -a media-fonts/noto media-fonts/noto-emoji media-fonts/nerd-fonts</code></pre>

<p>After installing fonts, update the font name in your dwm and st <code>savedconfig</code>
files (the <code>fonts[]</code> array in config.h), then rebuild to apply:</p>

<pre><code># Portage reads the savedconfig, compiles with the new font setting,
# and installs the updated binary. Restart dwm/st to see the change.
emerge -a x11-wm/dwm x11-terms/st</code></pre>

<h2>9 — DVD playback</h2>

<pre><code># mpv is a fork of mplayer — lightweight, scriptable, runs from the terminal.
# dvd:// tells mpv to use the DVD protocol; /dev/sr0 is the optical drive.
# libdvdcss (installed in the base guide) handles CSS decryption so
# commercial DVDs can be read.
mpv dvd:///dev/sr0

# Useful mpv controls during playback:
#   Space    → pause/resume
#   ←/→      → seek 5s / 10s
#   j        → cycle subtitles
#   #        → cycle audio tracks
#   f        → toggle fullscreen
#   q        → quit</code></pre>

<h2>10 — Autostart X on login (optional)</h2>

<p>If you don't want to type <code>startx</code> every time you log in, add this to
<code>~/.bash_profile</code>. It only triggers on tty1, so other TTYs stay as text consoles:</p>

<pre><code># ~/.bash_profile is sourced by bash on login shells (i.e. when you log in at a TTY).
# $DISPLAY is empty when no X server is running.
# $(tty) returns the current terminal device (e.g. /dev/tty1).
# 'exec startx' replaces the login shell with startx — when X exits,
# you're logged out (back to the login prompt), which is the expected behaviour.
if [[ -z "$DISPLAY" &amp;&amp; "$(tty)" == "/dev/tty1" ]]; then
    exec startx
fi</code></pre>

<hr>

<h2>Quick command recap</h2>

<pre><code># Full install one-liner
emerge -a x11-base/xorg-server x11-apps/xinit \
  x11-apps/xrandr x11-apps/setxkbmap x11-apps/xsetroot \
  x11-drivers/xf86-video-amdgpu x11-drivers/xf86-input-libinput \
  x11-misc/xwallpaper \
  x11-wm/dwm x11-terms/st x11-misc/dmenu x11-misc/slstatus \
  x11-misc/slock x11-misc/picom x11-misc/dunst \
  media-gfx/feh media-gfx/scrot app-misc/ranger media-video/mpv \
  media-libs/mesa media-libs/vulkan-loader dev-util/vulkan-tools \
  media-video/pipewire media-video/wireplumber \
  media-fonts/terminus-font</code></pre>

<hr>

<div class="nav">
  <strong>Back to:</strong>
  <a href="../README.md">README</a> ·
  <a href="02-kernel-customization.html">Kernel Customization</a>
</div>

</body>
</html>
