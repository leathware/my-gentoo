<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>01 — Common Post-Install Base Setup</title>
<style>
  :root { --bg: #fff; --fg: #1a1a1a; --muted: #555; --border: #d0d0d0;
          --code-bg: #f4f4f4; --accent: #4e4187; }
  *, *::before, *::after { box-sizing: border-box; }
  html { font-size: 15px; }
  body { font-family: "Inter", "Segoe UI", system-ui, sans-serif;
         color: var(--fg); background: var(--bg);
         max-width: 52rem; margin: 2rem auto; padding: 0 1.5rem;
         line-height: 1.6; }
  h1 { font-size: 1.8rem; border-bottom: 2px solid var(--accent); padding-bottom: .4rem; }
  h2 { font-size: 1.35rem; margin-top: 2rem; color: var(--accent); }
  h3 { font-size: 1.1rem; margin-top: 1.4rem; }
  blockquote { border-left: 4px solid var(--accent); margin: 1rem 0;
               padding: .5rem 1rem; background: #f9f8ff; color: var(--muted); }
  code { font-family: "JetBrains Mono", "Fira Code", "Consolas", monospace;
         font-size: .88em; background: var(--code-bg); padding: .15em .35em;
         border-radius: 3px; }
  pre { background: var(--code-bg); border: 1px solid var(--border);
        border-radius: 5px; padding: 1rem; overflow-x: auto;
        line-height: 1.45; }
  pre code { background: none; padding: 0; font-size: .85rem; }
  table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
  th, td { border: 1px solid var(--border); padding: .45rem .75rem; text-align: left; }
  th { background: var(--code-bg); }
  hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }
  a { color: var(--accent); }
  .nav { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);
         font-size: .9rem; }
  @media print {
    body { max-width: 100%; margin: 0; padding: 0; font-size: 11pt; }
    pre { white-space: pre-wrap; word-break: break-all; border: 1px solid #ccc; }
    a { color: inherit; text-decoration: none; }
    h2 { page-break-after: avoid; }
    pre, table { page-break-inside: avoid; }
    .nav { display: none; }
  }
</style>
</head>
<body>

<h1>Common Post-Install Base Setup</h1>

<blockquote>
Assumes you just finished a Gentoo <strong>minimal OpenRC</strong> install with the
<strong>distribution kernel</strong> (<code>sys-kernel/gentoo-kernel</code>) and selected a
<strong>desktop profile</strong> during install — either <code>desktop</code> (for DWM) or
<code>desktop/plasma</code> (for KDE).
Ethernet is up and you can <code>emerge</code> packages. Everything below happens as <strong>root</strong>.
</blockquote>

<blockquote>
<strong>Why the desktop profile during install?</strong>  Selecting the desktop profile early
means the base desktop USE flags (<code>X</code>, <code>dbus</code>, <code>elogind</code>, etc.)
are already active. When you deploy the KDE or DWM make.conf later, the
USE-flag delta is small and Portage resolves <code>@world</code> cleanly in a single pass —
no circular dependency headaches.
</blockquote>

<hr>

<h2>0 — During the Gentoo install (handbook reminder)</h2>

<p>When the handbook tells you to pick an eselect profile, choose a <strong>desktop</strong>
variant — <em>not</em> the default minimal one:</p>

<pre><code># Inside chroot, after emerge --sync
eselect profile list

# Pick the right profile for your desktop path:
#   default/linux/amd64/23.0/desktop          ← DWM path (use this one)
#   default/linux/amd64/23.0/desktop/plasma   ← KDE path
eselect profile set &lt;N&gt;</code></pre>

<blockquote>
<strong>Which profile for which desktop?</strong><br>
<strong>DWM → <code>desktop</code></strong> (plain). This gives you the base desktop USE flags
(<code>X</code>, <code>dbus</code>, <code>elogind</code>) without any KDE/Qt baggage. The <code>desktop/plasma</code>
profile enables <code>kde</code>, <code>qt5</code>, <code>qt6</code>, <code>widgets</code>, etc. globally — meaning
every package that <em>can</em> build with Qt support <em>will</em>, even though you'll
never use it. That's wasted compile time and disk space.<br>
<strong>KDE → <code>desktop/plasma</code></strong>. This pre-enables the KDE/Qt USE flags at the
profile level, so Portage knows to build the full Plasma stack.
</blockquote>

<h2>1 — Sync &amp; get the repo</h2>

<pre><code># ── Sync the Portage tree ───────────────────────────────────────────
# emerge --sync downloads the latest package database (ebuilds) from the
# Gentoo mirrors. This is the equivalent of 'apt update' on Debian — it
# fetches metadata, not actual packages. Always sync before installing.
emerge --sync

# ── Install Git ───────────────────────────────────────────────────
# The minimal install doesn't include git. We need it to clone this repo.
# -a (--ask) shows what will be installed and asks for confirmation.
emerge -a dev-vcs/git

# ── Clone this repo ───────────────────────────────────────────────
# Downloads the repo with the make.conf templates, setup script, and docs.
# /root/my-gentoo is a convenient location since you're running as root.
git clone https://github.com/leathware/my-gentoo.git /root/my-gentoo</code></pre>

<h2>2 — Deploy make.conf &amp; update @world</h2>

<h3>2a — Generate the make.conf</h3>

<p>The setup script detects your CPU flags and deploys the right make.conf
template. That's all it does — no emerge, no profile changes.</p>

<pre><code># Interactive — asks KDE or DWM, detects CPU flags, deploys make.conf:
/root/my-gentoo/scripts/setup-makeconf.sh

# Or pass the profile directly:
/root/my-gentoo/scripts/setup-makeconf.sh kde
/root/my-gentoo/scripts/setup-makeconf.sh dwm</code></pre>

<p>Review the result:</p>

<pre><code># Check that the USE flags and CPU_FLAGS_X86 look correct:
cat /etc/portage/make.conf</code></pre>

<h3>2b — Set the eselect profile (if you haven't already)</h3>

<pre><code># Show your current profile:
eselect profile show

# If you're on KDE and not already on desktop/plasma, switch now:
# (DWM users should already be on 'desktop' — skip this step)
eselect profile list
eselect profile set &lt;N&gt;   # pick desktop/plasma or desktop/plasma/openrc</code></pre>

<h3>2c — Update @world</h3>

<p>Now apply the new USE flags to every installed package. Since you're
already on a desktop profile, this is a straightforward single-pass update.</p>

<pre><code># ── Rebuild everything affected by the new make.conf ─────────────────
# --ask    → shows the merge list and asks for confirmation before starting
# --update → update packages to latest available versions
# --deep   → check the ENTIRE dependency tree, not just top-level packages
# --newuse → rebuild any package whose USE flags changed
emerge --ask --update --deep --newuse @world</code></pre>

<h3>2d — Clean up</h3>

<pre><code># ── Remove orphaned packages ───────────────────────────────────────
# depclean finds packages that nothing in @world depends on any more
# (leftover dependencies from old USE flags) and removes them.
emerge --ask --depclean

# ── Check for broken library links ─────────────────────────────────
# revdep-rebuild scans every installed binary/library for broken .so links
# (e.g. a library was upgraded and another package still links the old version).
# Install gentoolkit first if you don't have it:
emerge --ask app-portage/gentoolkit
revdep-rebuild

# ── Refresh the environment ───────────────────────────────────────
# env-update regenerates /etc/env.d cache files (ld.so.conf, PATH, etc.).
# source /etc/profile picks up the changes in your current shell.
env-update &amp;&amp; source /etc/profile</code></pre>

<h3>make.conf — KDE Plasma profile</h3>

<pre><code># /etc/portage/make.conf — KDE Plasma desktop
# Hardware: AMD Ryzen 9 9800X3D · RX 7800 XT · X870 Taichi Lite · DVD reader
# Init: OpenRC
# ------------------------------------------------------------------

# ── Compiler flags (Zen 5) ──────────────────────────────────────────
# -march=native lets GCC detect the exact µarch at compile time.
# If you cross-compile or distcc, replace with -march=znver5 (GCC ≥ 14).
COMMON_FLAGS="-march=native -O2 -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"

# ── CPU FLAGS (inserted by setup-makeconf.sh) ───────────────────────
CPU_FLAGS_X86="&lt;run cpuid2cpuflags to populate&gt;"

# ── Parallelism (8C / 16T) ─────────────────────────────────────────
MAKEOPTS="-j16 -l16"
EMERGE_DEFAULT_OPTS="--jobs=4 --load-average=16 --with-bdeps=y --keep-going"

# ── Portage behaviour ──────────────────────────────────────────────
FEATURES="candy fixlafiles unmerge-orphans parallel-fetch"
ACCEPT_LICENSE="-* @FREE @BINARY-REDISTRIBUTABLE"
ACCEPT_KEYWORDS="amd64"

# ── Hardware ────────────────────────────────────────────────────────
VIDEO_CARDS="amdgpu radeonsi"
INPUT_DEVICES="libinput"
GRUB_PLATFORMS="efi-64"

# ── Locale ──────────────────────────────────────────────────────────
L10N="en"
LINGUAS="en"
LC_MESSAGES=C.utf8

# ── Global USE — KDE Plasma full desktop ────────────────────────────
# Wayland-first but keep X11 for compatibility; PipeWire for audio;
# full Plasma/Qt6 stack; optical media support for the DVD drive.
USE="
  X wayland
  dbus elogind policykit udisks
  bluetooth networkmanager
  pipewire sound-server screencast
  vulkan opengl vaapi
  alsa
  dvd dvdread cdda cdr
  kde plasma qt6 qt5 widgets declarative qml
  activities semantic-desktop
  -gnome -systemd -telemetry
"</code></pre>

<h3>make.conf — DWM / suckless profile</h3>

<pre><code># /etc/portage/make.conf — DWM / suckless minimal desktop
# Hardware: AMD Ryzen 9 9800X3D · RX 7800 XT · X870 Taichi Lite · DVD reader
# Init: OpenRC
# ------------------------------------------------------------------

# ── Compiler flags (Zen 5) ──────────────────────────────────────────
# -march=native lets GCC detect the exact µarch at compile time.
# If you cross-compile or distcc, replace with -march=znver5 (GCC ≥ 14).
COMMON_FLAGS="-march=native -O2 -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"

# ── CPU FLAGS (inserted by setup-makeconf.sh) ───────────────────────
CPU_FLAGS_X86="&lt;run cpuid2cpuflags to populate&gt;"

# ── Parallelism (8C / 16T) ─────────────────────────────────────────
MAKEOPTS="-j16 -l16"
EMERGE_DEFAULT_OPTS="--jobs=4 --load-average=16 --with-bdeps=y --keep-going"

# ── Portage behaviour ──────────────────────────────────────────────
FEATURES="candy fixlafiles unmerge-orphans parallel-fetch"
ACCEPT_LICENSE="-* @FREE @BINARY-REDISTRIBUTABLE"
ACCEPT_KEYWORDS="amd64"

# ── Hardware ────────────────────────────────────────────────────────
VIDEO_CARDS="amdgpu radeonsi"
INPUT_DEVICES="libinput"
GRUB_PLATFORMS="efi-64"

# ── Locale ──────────────────────────────────────────────────────────
L10N="en"
LINGUAS="en"
LC_MESSAGES=C.utf8

# ── Global USE — DWM suckless minimal ──────────────────────────────
# X11 only (no Wayland in vanilla suckless tools); PipeWire for audio;
# savedconfig lets you keep custom suckless config.h patches in portage;
# strip out everything KDE/GNOME/Qt.
USE="
  X
  dbus elogind
  alsa pipewire sound-server
  vulkan opengl vaapi
  savedconfig
  dvd dvdread
  -kde -plasma -qt5 -qt6 -gnome -systemd
  -bluetooth -networkmanager -telemetry
  minimal
"</code></pre>

<h2>3 — Essential system services (OpenRC)</h2>

<p><code>rc-update add &lt;service&gt; &lt;runlevel&gt;</code> registers a service
to start at a specific runlevel. The two you'll see here:</p>
<ul>
  <li><strong>default</strong> — runs during normal multi-user boot (most services go here)</li>
  <li><strong>boot</strong> — runs earlier, before <code>default</code> (used by services that other
      boot-time processes depend on)</li>
</ul>

<pre><code># ── Logging &amp; scheduling ─────────────────────────────────
# sysklogd is a system logger — it writes kernel and daemon messages to
# /var/log/ (syslog, messages, etc.). Without it you have no logs to debug.
# cronie is a cron daemon — it runs scheduled tasks (log rotation, Portage
# sync scripts, etc.) defined in /etc/crontab or per-user crontabs.
emerge -a app-admin/sysklogd sys-process/cronie
rc-update add sysklogd default   # start logging during normal boot
rc-update add cronie default     # start the cron scheduler during normal boot

# ── Seat management (replaces systemd-logind) ───────────
# elogind manages login sessions, seats, and power actions (shutdown, suspend).
# It's the standalone fork of systemd-logind for non-systemd systems.
# Desktops and Polkit require it to know "who is sitting at the console".
emerge -a sys-auth/elogind
rc-update add elogind boot       # boot runlevel — must be ready before dbus/desktop

# ── D-Bus (inter-process communication) ─────────────────
# D-Bus is a message bus that lets programs talk to each other. Nearly every
# desktop component uses it — elogind, NetworkManager, PipeWire, Bluetooth,
# Polkit, display managers, and most GUI apps.
emerge -a sys-apps/dbus
rc-update add dbus default

# ── NTP (time synchronisation) ──────────────────────────
# chrony keeps your system clock accurate by syncing with internet time
# servers (NTP). Needed for HTTPS certificates, logs, and cron accuracy.
emerge -a net-misc/chrony
rc-update add chronyd default</code></pre>

<h2>4 — Firmware &amp; microcode</h2>

<pre><code># ── CPU microcode ───────────────────────────────────────────────────
# Microcode is low-level firmware that patches the CPU's internal behaviour.
# AMD releases updates to fix bugs, security vulnerabilities (like Spectre),
# and improve stability. The kernel loads it at early boot before anything
# else runs, so the CPU is patched from the very first moment.
emerge -a sys-firmware/amd-microcode

# ── GPU / networking firmware blobs ────────────────────────────────
# Modern hardware (GPU, WiFi, Bluetooth) needs binary firmware "blobs"
# that the kernel loads at runtime. linux-firmware is a collection of
# these files. Without them, your RX 7800 XT won't initialise (it needs
# the amdgpu/navi32_* blobs), and WiFi/BT won't work either.
emerge -a sys-kernel/linux-firmware

# ── Rebuild GRUB to include microcode in the boot image ─────────────
# grub-mkconfig scans /boot for kernel images and generates the GRUB
# config file. After installing new firmware/microcode, re-run it so
# the microcode is packed into the initramfs and loaded at boot.
grub-mkconfig -o /boot/grub/grub.cfg</code></pre>

<h2>5 — User account</h2>

<pre><code># ── Create your daily-driver user ───────────────────────────────────
# -m             → create a home directory (/home/&lt;youruser&gt;)
# -G group,...   → add the user to these supplementary groups:
#   wheel    → can use sudo/doas (root privilege escalation)
#   audio    → direct access to sound devices (ALSA)
#   video    → access to GPU devices (/dev/dri/*)
#   input    → access to input devices (/dev/input/*)
#   usb      → access to USB devices
#   cdrom    → access to the DVD drive (/dev/sr0)
#   portage  → can read Portage temp files and distfiles
# -s /bin/bash   → set the login shell to bash
useradd -m -G wheel,audio,video,input,usb,cdrom,portage -s /bin/bash &lt;youruser&gt;

# Set the password for the new user (you'll type it twice):
passwd &lt;youruser&gt;</code></pre>

<p>Install <code>doas</code> or <code>sudo</code>:</p>

<pre><code># doas (minimal, suckless-friendly)
emerge -a app-admin/doas
echo "permit persist :wheel" &gt; /etc/doas.conf

# OR sudo (more common with KDE/Polkit)
emerge -a app-admin/sudo
visudo   # uncomment %wheel ALL=(ALL:ALL) ALL</code></pre>

<h2>6 — Networking</h2>

<p>Pick <strong>one</strong> approach. NetworkManager is full-featured (GUI applet in KDE,
auto-connects to known WiFi). dhcpcd is minimal (wired-only by default,
pairs with wpa_supplicant for WiFi in the DWM guide).</p>

<table>
  <tr><th>Tool</th><th>Install</th><th>Enable</th></tr>
  <tr>
    <td>NetworkManager (KDE default)</td>
    <td><code>emerge -a net-misc/networkmanager</code></td>
    <td><code>rc-update add NetworkManager default</code></td>
  </tr>
  <tr>
    <td>dhcpcd (minimal / DWM)</td>
    <td><code>emerge -a net-misc/dhcpcd</code></td>
    <td><code>rc-update add dhcpcd default</code></td>
  </tr>
</table>

<p>If you're switching from the installer's networking, disable the old service
first to avoid conflicts (two DHCP clients on the same interface will fight):</p>

<pre><code># rc-update del → removes a service from a runlevel (it won't start at boot).
# net.eth0 is the default interface service from the Gentoo installer.
# Replace eth0 with your actual interface name (check with: ip link).
rc-update del net.eth0 default</code></pre>

<h2>7 — Audio — PipeWire on OpenRC</h2>

<pre><code># ── PipeWire + WirePlumber ──────────────────────────────────────────
# PipeWire is a modern audio (and video) server that replaces PulseAudio.
# It provides drop-in PulseAudio and JACK compatibility, handles Bluetooth
# audio, and manages screen capture for Wayland screen sharing.
#
# WirePlumber is PipeWire's session manager — it handles policy decisions
# like which audio device is the default, routing, and permissions.
emerge -a media-video/pipewire media-video/wireplumber

# PipeWire runs as a USER service, not a system daemon. There's no init
# script to add to OpenRC. Instead, it starts per-session:
#
# For KDE:  Plasma starts PipeWire automatically via XDG autostart
#           (desktop files in /etc/xdg/autostart/). No action needed.
#
# For DWM:  Add these lines to ~/.xinitrc BEFORE 'exec dwm':
#   pipewire &amp;
#   wireplumber &amp;</code></pre>

<h2>8 — DVD / Optical drive</h2>

<pre><code># ── CD/DVD burning and region tools ─────────────────────────────────
# cdrtools provides cdrecord (burning), mkisofs (create ISO images),
# and cdda2wav (rip audio CDs). regionset lets you set/query the DVD
# drive's region code (required for some commercial DVDs).
emerge -a app-cdr/cdrtools app-misc/regionset

# Make sure your user is in the 'cdrom' group (done in step 5).
# Without cdrom group membership, the drive device (/dev/sr0) won't
# be accessible to non-root users.

# ── DVD decryption ────────────────────────────────────────────────
# libdvdcss decrypts CSS (Content Scramble System) used on commercial
# DVDs. Without it, VLC/mpv can see the disc but can't read the video.
emerge -a media-libs/libdvdcss</code></pre>

<h2>9 — Filesystem utilities &amp; misc</h2>

<pre><code># ── Filesystem tools ───────────────────────────────────────────────
# e2fsprogs  → ext2/ext3/ext4 filesystem tools (fsck.ext4, mkfs.ext4, tune2fs)
# dosfstools → FAT/FAT32 tools (needed for the EFI System Partition)
# ntfs3g     → NTFS read/write support via FUSE (for Windows drives/partitions)
emerge -a sys-fs/e2fsprogs sys-fs/dosfstools sys-fs/ntfs3g

# ── Archive tools ─────────────────────────────────────────────────
# unzip  → extract .zip files
# p7zip  → extract .7z, .rar, and other formats (7z command)
emerge -a app-arch/unzip app-arch/p7zip</code></pre>

<h2>10 — Understanding circular dependencies</h2>

<p>Sooner or later every Gentoo user hits a message like:</p>

<pre><code>!!! Error: circular dependencies:
(media-video/pipewire-1.0.7:0/0.4::gentoo, ...) depends on
(media-libs/libpulse-17.0::gentoo, ...) (runtime)
  is satisfied by ... pipewire[sound-server] ...</code></pre>

<p>This section explains <strong>what</strong> they are, <strong>why</strong> they happen, and exactly
how to break them.</p>

<h3>What is a circular dependency?</h3>

<p>A circular dependency (or "dep cycle") occurs when two or more packages
depend on each other — directly or indirectly — creating a loop that
Portage can't resolve on its own:</p>

<pre><code>Package A needs Package B   →   B needs A   →   ???
 (which one gets built first?)</code></pre>

<p>In practice, the cycle is usually triggered by USE flags.
The packages <em>can</em> build without each other's optional features,
but the flags tell Portage they need each other <em>with</em> those features.</p>

<h3>Common cycles on this hardware</h3>

<table>
  <tr><th>Package A</th><th>Package B</th><th>USE flag causing the loop</th></tr>
  <tr>
    <td><code>media-video/pipewire</code></td>
    <td><code>media-libs/libpulse</code></td>
    <td><code>sound-server</code> (each can provide/consume PulseAudio compat)</td>
  </tr>
  <tr>
    <td><code>media-libs/mesa</code></td>
    <td><code>media-libs/libva</code></td>
    <td><code>vaapi</code> (mesa provides VA-API, libva links against mesa)</td>
  </tr>
  <tr>
    <td><code>dev-qt/qtmultimedia</code></td>
    <td><code>media-video/pipewire</code></td>
    <td><code>pipewire</code> / <code>qml</code></td>
  </tr>
  <tr>
    <td><code>sys-auth/elogind</code></td>
    <td><code>sys-apps/dbus</code></td>
    <td><code>elogind</code> (dbus needs elogind, elogind needs dbus)</td>
  </tr>
</table>

<blockquote>
<strong>Why did we avoid most of these?</strong> By selecting the <strong>desktop profile
during install</strong>, the base USE flags (<code>X</code>, <code>dbus</code>, <code>elogind</code>, etc.) were
<em>already active</em> when you first built those packages. The cycle only bites
when you flip many flags at once on a minimal profile.
</blockquote>

<h3>How to fix a circular dependency</h3>

<p>The general strategy is: <strong>break the loop by temporarily disabling the
offending USE flag, build the packages, then re-enable it.</strong></p>

<h4>Step 1 — Read the error</h4>

<p>Portage tells you which packages and which USE flags form the cycle.
Look for lines like <code>caused by ... USE flag ...</code> or
<code>is satisfied by ... [flag]</code>.</p>

<h4>Step 2 — Create a temporary <code>package.use</code> override</h4>

<pre><code># Example: break the pipewire ↔ libpulse cycle
# Temporarily build pipewire without sound-server
echo "media-video/pipewire -sound-server" &gt;&gt; /etc/portage/package.use/zzz-temp-circ

# Example: break the mesa ↔ libva cycle
echo "media-libs/mesa -vaapi" &gt;&gt; /etc/portage/package.use/zzz-temp-circ</code></pre>

<p>The <code>zzz-temp-circ</code> filename sorts last, so it overrides earlier entries.
You can stack as many overrides as you need in the same file.</p>

<h4>Step 3 — First pass: emerge with the crippled flags</h4>

<pre><code># --oneshot so these partial builds don't get added to @world
emerge --ask --oneshot media-video/pipewire media-libs/mesa</code></pre>

<p>This installs the packages <em>without</em> the features that caused the loop.
Their dependencies can now find them on disk.</p>

<h4>Step 4 — Remove the override and rebuild</h4>

<pre><code># Remove the temporary file
rm /etc/portage/package.use/zzz-temp-circ

# Re-run the full update — Portage will now see the flags
# are back and rebuild with full features
emerge --ask --update --deep --newuse @world</code></pre>

<h4>Step 5 — Verify and clean up</h4>

<pre><code># Remove orphaned packages from the partial builds
emerge --ask --depclean

# Ensure no broken library links remain
revdep-rebuild</code></pre>

<h3>Other tips for circular deps</h3>

<ul>
  <li><strong><code>emerge --backtrack=300</code></strong> — lets Portage try more combinations
      before giving up. Sometimes it finds a path on its own:
      <pre><code>emerge --ask --backtrack=300 --update --deep --newuse @world</code></pre></li>
  <li><strong><code>emerge --nodeps</code></strong> — force-installs a package ignoring deps.
      Use sparingly and always follow with a full <code>@world</code> rebuild.</li>
  <li><strong>Check the Gentoo wiki</strong> — many circular deps are known and documented:
      <code>https://wiki.gentoo.org/wiki/Circular_dependencies</code></li>
  <li><strong>Don't panic</strong> — circular deps are a Portage planning problem, not a
      system breakage. Your installed packages still work fine while you sort it out.</li>
</ul>

<h2>11 — Cleanup after everything is done</h2>

<p>Once your desktop is running and everything works, claw back disk space
and tidy up the system. These commands are safe to run at any time.</p>

<h3>Remove orphaned packages</h3>

<pre><code># depclean removes packages that nothing in @world depends on any more
# (leftover build deps, replaced packages, etc.)
# --ask shows you what will be removed before doing it
emerge --ask --depclean</code></pre>

<h3>Check for broken library links</h3>

<pre><code># revdep-rebuild scans every installed binary/library and looks for
# broken .so symlinks (e.g. a library was upgraded and another package
# still links the old version). It rebuilds anything broken.
revdep-rebuild</code></pre>

<h3>Clean Portage build files</h3>

<pre><code># /var/tmp/portage holds the working directories for every compile.
# Portage should clean up after itself, but interrupted builds can
# leave behind gigabytes of temp files.
rm -rf /var/tmp/portage/*</code></pre>

<h3>Clean source tarballs (distfiles)</h3>

<pre><code># eclean-dist removes old/unused source tarballs from /var/cache/distfiles.
# --deep removes everything not needed by currently-installed package versions.
# Install gentoolkit first if you haven't already.
emerge -a app-portage/gentoolkit
eclean-dist --deep</code></pre>

<h3>Clean binary packages (if any)</h3>

<pre><code># If you ever built binpkgs (--buildpkg), this removes stale ones
eclean-pkg --deep</code></pre>

<h3>Remove old kernels</h3>

<pre><code># If you installed dist-kernel and upgraded, old versions pile up.
# List installed kernels:
eselect kernel list

# Remove a specific old version (replace with actual version):
emerge --deselect sys-kernel/gentoo-kernel:&lt;old-version&gt;
emerge --depclean

# Clean old kernel sources from /usr/src:
rm -rf /usr/src/linux-&lt;old-version&gt;

# Clean leftover modules:
rm -rf /lib/modules/&lt;old-version&gt;

# Rebuild GRUB menu to remove stale entries:
grub-mkconfig -o /boot/grub/grub.cfg</code></pre>

<h3>Quick cleanup one-liner</h3>

<pre><code># The "daily driver" cleanup — run after any major emerge session:
emerge --ask --depclean &amp;&amp; revdep-rebuild &amp;&amp; eclean-dist --deep &amp;&amp; rm -rf /var/tmp/portage/*</code></pre>

<hr>

<div class="nav">
  <strong>Next →</strong> go to either:
  <ul>
    <li><a href="02-kernel-customization.html">Kernel Customization</a> (recommended before desktop setup)</li>
    <li><a href="03-kde-plasma-setup.html">KDE Plasma Setup</a></li>
    <li><a href="04-dwm-suckless-setup.html">DWM / Suckless Setup</a></li>
  </ul>
</div>

</body>
</html>
